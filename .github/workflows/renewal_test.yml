name: Manual Renewal Test

on:
  workflow_dispatch:
    inputs:
      target_url:
        description: 'Target URL'
        required: true
      proxy_server:
        description: 'SOCKS5 Proxy (socks5://user:pass@host:port)'
        required: false
      action_type:
        description: 'Action Type'
        required: true
        default: 'keepalive'
        type: choice
        options:
        - keepalive
        - renewal
      timeout:
        description: 'Timeout (seconds)'
        default: '120'

jobs:
  renewal-test:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Install System Dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y xvfb google-chrome-stable
    
    - name: Install Python Dependencies
      run: |
        pip install seleniumbase
        seleniumbase install chromedriver

    - name: Run Renewal Task
      env:
        TARGET_URL: ${{ inputs.target_url }}
        PROXY_SERVER: ${{ inputs.proxy_server }}
        ACTION_TYPE: ${{ inputs.action_type }}
        TIMEOUT: ${{ inputs.timeout }}
        # Add basic credentials if needed by login page, or prompt user to add to secrets later
        USERNAME: "test_user" 
        PASSWORD: "test_password"
      run: |
        python bypass-service/github_runner.py

    - name: Upload Artifacts (Screenshots/Logs)
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: execution-artifacts
        path: github_artifacts/
